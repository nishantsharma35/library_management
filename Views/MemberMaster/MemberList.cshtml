@model IEnumerable<library_management.Models.Member>

@{
    Layout = "/Views/Shared/_mainLayout.cshtml";
    ViewData["Title"] = "Member List";
}

<link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css" rel="stylesheet">
<link href="~/assets/css/sb-admin-2.min.css" rel="stylesheet">

<div class="card shadow mb-4">
    <div class="card-header py-3 text-center">
        <h2 class="m-0 font-weight-bold text-primary">Member List</h2>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Profile Image</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Joining Date</th>
                        <th>Verification Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var member in Model)
                    {
                        <tr class="member-row" data-status="@member.VerificationStatus">
                            <td>
                                <img src="@member.Picture" alt="img" class="img-fluid rounded-circle" style="width: 50px; height: 50px;">
                            </td>
                            <td>@member.Name</td>
                            <td>@member.Email</td>
                            <td>@member.Joiningdate</td>
                            <td>
                                <span class="badge @(member.VerificationStatus == "Pending" ? "badge-warning" : member.VerificationStatus == "Accepted" ? "badge-success" : "badge-danger")">
                                    @member.VerificationStatus
                                </span>
                            </td>
                            <td>
                                @if (member.VerificationStatus == "Pending")
                                {
                                    <button class="btn btn-success btn-sm approve-btn" data-id="@member.Id">Approve</button>
                                    <button class="btn btn-danger btn-sm reject-btn" data-id="@member.Id">Reject</button>
                                }
                                else
                                {
                                    <a class="btn btn-primary btn-sm" href="@Url.Action("Details", "MemberMaster", new { id = member.Id })">
                                        <i class="fas fa-info-circle"></i> Details
                                    </a>
                                    <a class="btn btn-warning btn-sm" href="@Url.Action("AddMember", "MemberMaster", new { id = member.Id })">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                    <button class="btn btn-danger btn-sm delete-btn" data-id="@member.Id">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                }
                            </td>
                        </tr>
                    }
                   
                </tbody>
            </table>
        </div>
    </div>
</div>




@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="~/libraryjs/Delete.js"></script>
   

  
             
    <script>
         var approveUrl = '@Url.Action("ApproveOrRejectUser", "MemberMaster")';

         $(document).on('click', '.approve-btn', function () {
             var memberId = $(this).data('id');
             $.ajax({
                 url: approveUrl,
                 type: 'POST',
                 data: { userId: memberId, approve: true },
                 success: function (response) {
                     Swal.fire("Success!", response.message, "success").then(() => location.reload());
                 },
                 error: function () {
                     Swal.fire("Error!", "Something went wrong.", "error");
                 }
             });
         });

         $(document).on('click', '.reject-btn', function () {
             var memberId = $(this).data('id');
             $.ajax({
                 url: approveUrl,
                 type: 'POST',
                 data: { userId: memberId, approve: false },
                 success: function (response) {
                     Swal.fire("Success!", response.message, "success").then(() => location.reload());
                 },
                 error: function () {
                     Swal.fire("Error!", "Something went wrong.", "error");
                 }
             });
         });
    </script>


   

}




